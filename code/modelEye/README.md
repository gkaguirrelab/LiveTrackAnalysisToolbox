# modelEye
These routines implement a ray-traced model eye. A primary application of the model is to describe the entrance pupil in the image plane for a rotated eye. The entrance pupil is described by the parameters of an ellipse that fits the pupil perimeter.

The function `pupilProjection_fwd` implements the forward model of this projection. Inputs to this routine are:
 * `eyePose` which is a vector that describes dynamic aspects of the eye, specifically rotation in degrees of azimuth, elevation, and torsion, and the radius of the exit pupil in mm.
 * `sceneGeometry` which is a structure that describes static aspects of the scene, including the properties and position of a pinhole camera model and the eye. The sceneGeometry structure is generated by the function `createSceneGeometry`.

The function `pupilProjection_inv` implements a search over eyePose parameters and executions of the forwrad model to find the eyePose values that best describe an observed entrance pupil ellipse.

The forward model of the appearance of the pupil and iris accounts for the refractive properties of the cornea (and any artificial lenses between the eye and the camera). The routine `virtualImageFunc.m` calculates the effect of refraction, making use of calls to `rayTraceCenteredSurfaces.m`. An improvement in the execution time of the forward model can be achieved by compiling the ray tracing routines. To do so, issue the command `compileVirtualImageFunc` at the MATLAB console. A compiled MEX file version of `virtualImageFunc` will be placed on the MATLAB path if it is not already present.

A rough hierarchy of the functions is as follows:
```
                             pupilProjection_inv
			             |
				     V
createSceneGeometry    -->  pupilProjection_fwd
 - modelEyeParameters		     |
 - returnRefractiveIndex	     V
 - addContactLens      	     virtualImageFunc
 - addSpectaleLens		     |
 				     V
 			 rayTraceCenteredSurfaces
```

Every function has associated examples in the header comments. This command issued in the MATLAB console will test all examples:
```
	[names,status] = RunExamples(fullfile(userpath(),'toolboxes','transparentTrack','code','modelEye'))
```
